schema: '2.0'
stages:
  split:
    cmd: agot data split --seed 0 --test-size 0.1 --filename data/raw/cards.jsonl
    deps:
    - path: data/raw/cards.jsonl
      md5: e8fb81560680a8ddc61c2b63a2e9c3df
      size: 1691969
    outs:
    - path: data/splits/test.jsonl
      md5: e22f94a045f2389a3777254619bd91d7
      size: 170955
    - path: data/splits/train.jsonl
      md5: 35c0726c5d08c55e8ca2ecac5c9c9156
      size: 1546034
  lm_preprocess_train:
    cmd: agot data preprocess-kenlm data/splits/train.jsonl type_code faction_code
      name cost text is_unique is_loyal
    deps:
    - path: data/splits/train.jsonl
      md5: 35c0726c5d08c55e8ca2ecac5c9c9156
      size: 1546034
    outs:
    - path: data/lm/train.txt
      md5: 3e48a008e8f47b4d79f7d01b4593faa8
      size: 335686
  lm_preprocess_test:
    cmd: agot data preprocess-kenlm data/splits/test.jsonl type_code faction_code
      name cost text is_unique is_loyal
    deps:
    - path: data/splits/test.jsonl
      md5: e22f94a045f2389a3777254619bd91d7
      size: 170955
    outs:
    - path: data/lm/test.txt
      md5: dd1df3adcf25b480bac1d46bc906495a
      size: 37458
  kenlm_train:
    cmd: lmplz -o 6 --text data/lm/train.txt --arpa models/kenlm/lm.arpa
    deps:
    - path: data/lm/train.txt
      md5: 3e48a008e8f47b4d79f7d01b4593faa8
      size: 335686
    outs:
    - path: models/kenlm/lm.arpa
      md5: 2c221a9b1608206509df0444f7e0cf62
      size: 6988246
  kenlm_evaluate:
    cmd: agot kenlm evaluate
    deps:
    - path: data/lm/test.txt
      md5: dd1df3adcf25b480bac1d46bc906495a
      size: 37458
    - path: data/lm/train.txt
      md5: 3e48a008e8f47b4d79f7d01b4593faa8
      size: 335686
    - path: models/kenlm/lm.arpa
      md5: 2c221a9b1608206509df0444f7e0cf62
      size: 6988246
    outs:
    - path: metrics/kenlm.json
      md5: 6e451096a7e1ecc3272debb768bb8fa8
      size: 72
